% This is a configuration file of rebar3, so that Ceylan-WOOPER can be directly
% tested separately (i.e. without needing to install upper layers, i.e. software
% depending on it): emulates a user of the WOOPER library.

% If the name of this file is 'rebar.config', then it is a generated file,
% otherwise it is a template (in conf/rebar-for-testing.config.template), meant
% to be filled by information coming from GNUmakevars.inc.

% To be run through the 'test-hex-package' make target.

% Note that this testing relates just to the ability of bringing up the
% specified WOOPER version as a dependency; there is no actual test involved,
% i.e. no depending sources that would make use here of WOOPER.



% Settings for the 'default' profile follow.
%
% Implied: {myriad, "MYRIAD_VERSION_FOR_REBAR"}
{deps, [ {wooper, "VERSION_FOR_REBAR3" } ] }.


% This testing just targets to trigger the build of WOOPER (and its Myriad
% dependency), not of specific tests making use of it.

{pre_hooks, [ {compile, "echo 'WOOPER testing pre-compile hook!'"} ]}.

{post_hooks, [
	{compile, "echo 'WOOPER testing post-compile hook!'"} ]}.



% For release generation:
%
% (defaults are for the development mode)
%
% With relx, only direct dependencies need to be listed, and version constraints
% can be used, instead of exact, specific versions.
%
{relx, [

  {release, {wooper_release, "VERSION_FOR_REBAR3"},
            [sasl, wooper]},

  %{sys_config, "./config/sys.config"},
  %{vm_args, "./config/vm.args"},

  {dev_mode, true},
  {include_erts, false},

  {extended_start_script, true},
  {include_src, false}

]}.


{profiles, [

  % Production mode:
  {prod, [ {relx, [

	% Same as default profile:
	{release, {wooper_release, "VERSION_FOR_REBAR3"}},
			  [sasl, wooper]},

	% For the build makefiles:
	{env, [ { 'REBAR_PROFILE', "prod" } ] },

	% Not wanting the release to contain symlinks to applications:
	{dev_mode, false},

	% Creating a full target system:
	{include_erts, true},

	{extended_start_script, true},
	{include_src, false}

	]}]

}] }.


% For packages:
%
% (use 'rebar3 update' to enable the hex plugin)
%
{plugins, [rebar3_hex]}.